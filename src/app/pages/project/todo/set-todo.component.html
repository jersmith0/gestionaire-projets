<!-- src/app/dialogs/set-todo/set-todo.component.html -->
<h2 mat-dialog-title>{{ todo?.id ? 'Modifier' : 'Ajouter' }} une tâche</h2>

<mat-dialog-content>
  @if (user$ | async; as user) {
    <form [formGroup]="todoForm" (ngSubmit)="onSubmit()">
      
      <!-- Titre -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Titre</mat-label>
        <input matInput formControlName="title" placeholder="Titre de la tâche">
        <mat-error *ngIf="todoForm.get('title')?.hasError('required')">
          Le titre est requis
        </mat-error>
      </mat-form-field>

      <!-- Description -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description" rows="3" placeholder="Description détaillée"></textarea>
        <mat-error *ngIf="todoForm.get('description')?.hasError('required')">
          La description est requise
        </mat-error>
      </mat-form-field>

      <!-- Priorité -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Priorité</mat-label>
        <mat-select formControlName="priority">
          <mat-option value="low">Basse</mat-option>
          <mat-option value="medium">Moyenne</mat-option>
          <mat-option value="high">Haute</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Objectif (Goal) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Objectif associé (optionnel)</mat-label>
        <mat-select formControlName="goalId">
          <mat-option [value]="null">Aucun objectif</mat-option>
          @for (goal of goals$ | async; track goal.id) {
            <mat-option [value]="goal.id">
              {{ goal.title }} ({{ goal.type }})
            </mat-option>
          }
        </mat-select>
        <mat-hint>Lier cette tâche à un OKR ou KPI</mat-hint>
      </mat-form-field>

    </form>
  }
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button mat-dialog-close>Annuler</button>
  @if (user$ | async; as user) {
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSubmit()"
      [disabled]="todoForm.invalid"
    >
      {{ todo?.id ? 'Modifier' : 'Créer' }}
    </button>
  }
</mat-dialog-actions>